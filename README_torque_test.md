# 28BYJ-48 + A4988（Raspberry Pi Pico）トルクテスト手順

## 1. 目的

このプロジェクトは、改造した **28BYJ-48 ステッピングモーター** を **A4988 ドライバ** で駆動し、**Raspberry Pi Pico** で制御するための **トルクおよび脱調評価用セットアップ** です。

目的:
- 負荷時の脱調限界を特定する
- 各マイクロステップモードでのトルク特性を比較する
- ステップ周波数が安定性に与える影響を評価する
- 実用アプリ向けの最適なマイクロステップと速度設定を選定する

本セットアップは **再現性・電気的安全性・挙動の明確さ** を重視し、抽象化よりも実挙動の理解を優先します。

---

## 2. ハードウェア選定の理由

### 2.1 Raspberry Pi Pico
- MicroPython でも安定した GPIO タイミング
- A4988 に適合する 3.3V ロジック
- USB シリアルでリアルタイムにパラメータ制御

### 2.2 A4988 ステッピングドライバ
- STEP / DIR インターフェイス（シンプルで決定論的）
- ハードウェア電流制限（Vref 調整可）
- マイクロステップ対応（フル～1/16）
- 電気的挙動が広く理解されている

### 2.3 28BYJ-48 ステッピングモーター（改造版）
- 元はユニポーラ（5 線式）
- **赤の共通線を切り離し、バイポーラに改造**
- 減速ギアで低速時の保持トルクが高い
- 安全性のため **5V モーター電源** で使用

> 注: このセットアップでは、28BYJ-48 のコイル電流に対して Vref が安全な値に調整済みであることを前提とします。

---

## 3. 配線

### 3.1 制御信号配線

| A4988 ピン | Pico GPIO |
|-----------|-----------|
| ENABLE    | GP2 |
| DIR       | GP3 |
| STEP      | GP4 |
| MS1       | GP6 |
| MS2       | GP7 |
| MS3       | GP8 |
| GND       | GND（共通） |

- ENABLE は **LOW アクティブ**
- MS ピンは **GPIO 直結で可（抵抗不要）**
- ロジック電圧: 3.3V（Pico）で問題なし

### 3.2 電源

- VMOT: 5V（モーター電源）
- VDD : 3.3V（ロジック電源）
- GND は Pico と A4988 で共通にすること

---

## 4. マイクロステップ設定（A4988）

| MS1 | MS2 | MS3 | モード |
|-----|-----|-----|-------|
| L | L | L | フル |
| H | L | L | 1/2 |
| L | H | L | 1/4 |
| H | H | L | 1/8 |
| H | H | H | 1/16 |

マイクロステップモードは Pico の GPIO で選択し、シリアルコマンドで変更可能。
**モード変更はモーター停止中に行うこと。**

---

## 5. 制御方法

### 5.1 STEP 信号
- 明示的に STEP パルスを生成
- パルス幅は保証（>5 µs）
- パルス間の待ち時間で周波数を制御

### 5.2 速度制御
- 速度は **STEP パルス間隔（µs）** で定義
- 待ち時間が短いほど速度上昇 → トルク余裕が減る

RPM などの抽象化を避け、直感的にトルクテストできる。

---

## 6. シリアルインターフェイス

### 6.1 速度制御
改行付きの数値を送信:

```
2000
1000
500
```

→ STEP の待ち時間（µs）を設定。

### 6.2 マイクロステップ制御
以下の文字列のいずれかを送信:

```
full
half
quarter
eighth
sixteenth
```

→ マイクロステップモードを変更（安全のための待ち時間を伴う）。

---

## 7. 推奨テスト手順

1. 以下で開始:
   - `full`
   - `2000 µs`
2. 待ち時間を段階的に短く:
   - 1500 → 1000 → 800 → 600 → ...
3. 機械的負荷を与える
4. 脱調が起きた待ち時間を記録
5. 各マイクロステップモードで繰り返す

これにより **トルク vs 速度 vs マイクロステップ** の定量比較が可能。

---

## 8. 設計方針

- **最大トルク基準としてフルステップ** を使用
- マイクロステッピングは **共振抑制とスムーズさ向上の手段** と捉え、トルク増強目的ではない
- 電気的安定性のため ENABLE は常時アクティブ
- 純粋なトルク限界を測るため加速ランプは使用しない

---

## 9. 想定される結果

- 脱調境界の明確化
- 共振に敏感な速度帯の把握
- エビデンスに基づくマイクロステップ選択
- 実負荷下での安定したモーター挙動

---

## 10. 注意

- 温度上昇が見られたら Vref かデューティを下げる
- すぐ脱調する場合は速度を下げるか配線を確認
- 本セットアップは **評価用途** であり量産制御を想定しない

---

## 11. ファイル

- `main.py`: MicroPython 制御コード
- `README.md`: 本書

---

以上。
